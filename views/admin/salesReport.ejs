<%- include ('../layouts/adminheader.ejs') %>

  <!-- Dashboard -->
  <li class="menu-item ">
    <a href="/admin/dashboard" class="menu-link">
      <i class="menu-icon tf-icons bx bx-home-circle"></i>
      <div data-i18n="Analytics">Dashboard</div>
    </a>
  </li>

  <li class="menu-item">
    <a href="/admin/userList" class="menu-link">

      <i class="menu-icon tf-icons bx bxs-user-detail"></i>
      <div data-i18n="Basic">User List</div>
    </a>
  </li>

  <li class="menu-item">
    <a href="/admin/adminProduct" class="menu-link">

      <i class="menu-icon tf-icons bx bxs-florist"></i>
      <div data-i18n="Basic">Product Details</div>
    </a>
  </li>


  <li class="menu-item active">
    <a href="/admin/adminCategory" class="menu-link">
      <i class="menu-icon tf-icons bx bx-table"></i>
      <div data-i18n="Analytics">Category</div>
    </a>
  </li>


  <li class="menu-item ">
    <a href="/admin/orderList" class="menu-link">
      <i class="menu-icon tf-icons bx bx-gift"></i>
      <div data-i18n="Analytics">Orders</div>
    </a>
  </li>

  <li class="menu-item ">
    <a href="/admin/banner" class="menu-link">
      <i class="menu-icon tf-icons bx bx-collection"></i>
      <div data-i18n="Analytics">Banner</div>
    </a>
  </li>
  <li class="menu-item ">
    <a href="/admin/offer" class="menu-link">
      <i class="menu-icon tf-icons bx bx-collection"></i>
      <div data-i18n="Analytics">offer</div>
    </a>
  </li>
  <li class="menu-item ">
    <a href="/admin/salesReport" class="menu-link">
      <i class="menu-icon tf-icons bx bx-collection"></i>
      <div data-i18n="Analytics">salesReport</div>
    </a>
  </li>

  <!-- Misc -->
  <!-- <li class="menu-header small text-uppercase"><span class="menu-header-text">Misc</span></li> -->
  <li class="menu-item">
    <a href="https://github.com/themeselection/sneat-html-admin-template-free/issues" target="_blank" class="menu-link">
      <i class="menu-icon tf-icons bx bx-"></i>
      <div data-i18n="Support"></div>
    </a>
  </li>
  <li class="menu-item">
    <a href="https://themeselection.com/demo/sneat-bootstrap-html-admin-template/documentation/" target="_blank"
      class="menu-link">
      <i class="menu-icon tf-icons bx bx-"></i>
      <div data-i18n="Documentation"></div>
    </a>
  </li>
  </ul>
  </aside>
  <!-- / Menu -->

  <!-- Layout container -->
  <div class="layout-page">
    <!-- Navbar -->

    <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
      id="layout-navbar">
      <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
        <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
          <i class="bx bx-menu bx-sm"></i>
        </a>
      </div>

      <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
        <!-- Search -->
        <div class="navbar-nav align-items-center">
          <div class="nav-item d-flex align-items-center">
            <i class="bx bx-search fs-4 lh-0"></i>
            <input type="text" class="form-control border-0 shadow-none" placeholder="Search..."
              aria-label="Search..." />
          </div>
        </div>
        <!-- /Search -->

        <ul class="navbar-nav flex-row align-items-center ms-auto">
          <!-- Place this tag where you want the button to render. -->
          <!-- <li class="nav-item lh-1 me-3">
        <a
          class="github-button"
          href="https://github.com/themeselection/sneat-html-admin-template-free"
          data-icon="octicon-star"
          data-size="large"
          data-show-count="true"
          aria-label="Star themeselection/sneat-html-admin-template-free on GitHub"
          >Star</a
        > -->
          </li>

          <!-- User -->
          <li class="nav-item navbar-dropdown dropdown-user dropdown">
            <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
              <div class="avatar avatar-online">
                <img src="/admin/assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle" />
              </div>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li>
                <a class="dropdown-item" href="#">
                  <div class="d-flex">
                    <div class="flex-shrink-0 me-3">
                      <div class="avatar avatar-online">
                        <img src="/admin/assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle" />
                      </div>
                    </div>
                    <div class="flex-grow-1">
                      <span class="fw-semibold d-block">John Doe</span>
                      <small class="text-muted">Admin</small>
                    </div>
                  </div>
                </a>
              </li>
              <li>
                <div class="dropdown-divider"></div>
              </li>
              <li>
                <a class="dropdown-item" href="#">
                  <i class="bx bx-user me-2"></i>
                  <span class="align-middle">My Profile</span>
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#">
                  <i class="bx bx-cog me-2"></i>
                  <span class="align-middle">Settings</span>
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#">
                  <span class="d-flex align-items-center align-middle">
                    <i class="flex-shrink-0 bx bx-credit-card me-2"></i>
                    <span class="flex-grow-1 align-middle">Billing</span>
                    <span class="flex-shrink-0 badge badge-center rounded-pill bg-danger w-px-20 h-px-20">4</span>
                  </span>
                </a>
              </li>
              <li>
                <div class="dropdown-divider"></div>
              </li>
              <li>
                <a class="dropdown-item" href="auth-login-basic.html">
                  <i class="bx bx-power-off me-2"></i>
                  <span class="align-middle">Log Out</span>
                </a>
              </li>
            </ul>
          </li>
          <!--/ User -->
        </ul>
      </div>
    </nav>

    <!-- / Navbar -->

    <!-- Content wrapper -->
    <div class="content-wrapper">
      <!-- Content -->

      <div class="container-xxl flex-grow-1 container-p-y">

        <br><br>
        <div class="">
          <!-- <form action="addcategory" method="post">
            <div class="input-group">
              <input type="text" class="form-control" name="category" placeholder="Add Category"
                aria-label="Recipient's username" aria-describedby="button-addon2" />
              <button class="btn btn-outline-primary" type="submit" id="button-addon2">add</button>
            </div>
          </form> -->
          <% if(typeof message !=='undefined'){ %>
          <p class="text text-danger"><%= message %></p>
            <% } %>
        </div>
        <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light"></span> </h4>
        <!-- <input type="date" name="" id="sDate" onchange="sales()">
        <input type="date" name="" id="eDate" onchange="sales()"> -->
        <!--download-->
        <div class="container justify-content-center align-items-center" >
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col-lg-12 col-xl-11">
                    <div class="card bg-transparent" style="border-radius: 25px;">
                        <div class="card-body p-md-2">
                            <div class="row justify-content-center" style=" display: flex; justify-content: center;">
                                <div class="col-md-2 col-lg-6 col-xl-5 order-2 order-lg-1 width-50" style="padding: 2rem;">
                                   
    
                                    <form class="mx-1 mx-md-2" >
          
                                        <div class="d-flex flex-row align-items-center mb-2">
                                          
                                          <div class="form-outline flex-fill m-b-5">
                                            <label class="form-label" for="form3Example1c">Start Date</label>
                                            <input type="date" id="sDate" onchange="sales()" class="form-control" name="couponName" required style="background-color:aliceblue;"/>
                                          </div>
                                        </div>


                                        <div class="d-flex flex-row align-items-center mb-2">
                                          
                                            <div class="form-outline flex-fill m-b-5">
                                              <label class="form-label" for="form3Example1c">End Date</label>
                                              <input type="date"  id="eDate" onchange="sales()" class="form-control" name="couponName" required style="background-color:aliceblue;" />
                                            </div>
                                          </div>
                                                    <!-- <div class="d-flex flex-row align-items-center mb-2"> -->
                                        <div class="d-flex flex-row align-items-center mb-2">
                                            <div class="form-outline flex-fill mb-0">
                                              <label class="form-label" for="form3Example4c" style="margin-top: 20px;">Download Report</label>
                                              <div class="dropdown" >
                                                <!-- <input type="text" id="form3Example4c" class="form-control" name="discount" required style="background-color:aliceblue;"/> -->
                                              </div>
                                            </div>
                                          </div> 

                                          <div style="margin-top: 10px;">
                                           <button class="btn btn-danger" id="downloadPdfBtn">PDF</button>
                                           <button class="btn btn-primary" id="downloadExcelBtn">EXCEL</button>
                                          </div>
                                      </form>
                                </div>  
                            </div>
                        </div>
          </div>







        <!--complete download-->
      

        <div class="card">
            <h5 class="card-header">Order List</h5>
            <div class="table-responsive text-nowrap">
              <div class="content table-responsive table-full-width">
                <table id="ordersTable" class="table table-striped">
                  <thead>
                  <th>SI NO</th>
                  <!-- <th>Images</th> -->
                  <th>Order Id</th>
                  
                  <th>Date</th>
                   <th>Payment Status</th>
                  <th>Bill Amount</th>
                  <th>Status</th>
                  
                  </thead>
                  <tbody id="tbody">
                   <% if(order.length>0){ %>
                    <% for(let i=1;i<=order.length;i++){%>
                        <th><%= i %></th>
                        
                        <td>
                          <%=order[i-1]._id %>
                        </td>
                      
                        
                        <td>
                          <%= order[i-1].createdAt.toDateString() %>
                        </td>
                        
                      
                        
                        
                        <td>
                          <%=order[i-1].payment %>
                        </td>
                        <td>
                          <%=order[i-1].products.totalPrice %>
                        </td>
                        <td>
                          <%= order[i-1].status %>
                        </td>
                        
                    </tr>
                    <%}} %>
                  </tbody>

                  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
                  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js"></script>
                  
                  
                  
                  <!-- SheetJS -->
                  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
                  
                  
                  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
                  
                  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
                  
                  
                  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                  <script>
                    // Download as PDF
                    // console.log(jsPDF);
                  document.getElementById('downloadPdfBtn').addEventListener('click', function() {
                    // Get the table element
                  
                  
                    var doc = new jsPDF()
                      doc.autoTable({ html: '#ordersTable' })
                      doc.save('sales.pdf')
                  });
                  
                  // Download as Excel
                  document.getElementById('downloadExcelBtn').addEventListener('click', function() {
                    // Get the table element
                    var table = document.getElementById('ordersTable');
                  
                    // Convert the table data to a worksheet object
                    var worksheet = XLSX.utils.table_to_sheet(table);
                  
                    // Create a new workbook and add the worksheet
                    var workbook = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(workbook, worksheet, 'Sales');
                  
                    // Save the Excel file
                    XLSX.writeFile(workbook, 'sales.xlsx');
                  });
                  
                  </script>





                    <script>
                        function sales() {
                            const startDate=document.getElementById('sDate').value
                            console.log(startDate);
                            const endDate=document.getElementById('eDate').value
                            console.log(endDate);
                            $.ajax({
                                url:'/admin/salesDownload',
                                type:'POST',
                                data:{sDate:startDate,eDate:endDate},
                                success:function(data){
                                    console.log(data);
                                    let tablebody='';

                                    if(data.orderData.length>0){
                                        for(i=0;i<data.orderData.length;i++){
                                            tablebody +=`<tr>
                                                <th>${i+1}</th>
                                                    <td>${data.orderData[i]._id}</td>
                                                    <td>${new Date(data.orderData[i].createdAt).toDateString()}</td>
                                                    <td>${data.orderData[i].payment}</td>
                                                    <td>${data.orderData[i].products.totalPrice}</td>
                                                    <td>${data.orderData[i].status}</td>
                                                    
                                                     `
                                        }
                                    }else{

                                    }
                                    document.getElementById("tbody").innerHTML=tablebody;

                                },
                                error:function(jqXHR,textStatus,errorThrow){
                                    console.log(textStatus,errorThrow);
                                }
                            })
                            
                        }

                        
                    </script>

                    <%- include ('../layouts/adminfooter.ejs') %>